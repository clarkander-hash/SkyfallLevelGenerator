<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7x22 Grid with Images</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
width: 100%;
        }
        .grid-cell {
            height: 37px;
        }
        .grid-cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
  @media print {
            body {
                margin: 0;
                padding: 0;
                background: white !important;
            }
            
            header {
                display: none;
            }
                #grid1 {
                height: 7.3in !important;
                width: 3in !important;
                max-width: none !important;
                margin: 0 !important;
                page-break-inside: avoid;
position: absolute;
bottom:0.42in;
left:0;
            }
#grid2 { 
		height: 7.3in !important;
                width: 3in !important;
                max-width: none !important;
                margin: 0 !important;
                page-break-inside: avoid;
position: absolute;
bottom:0.42in;
right:0;
}
            
            .grid-cell {
                break-inside: avoid;
            }
            
            main {
                height: auto !important;
                padding: 0 !important;
            }
            
            .flex-1 {
                overflow: visible !important;
            }
        }


    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100">
    <main class="h-full flex flex-col">
        <header class="mb-4">
            <h1 class="text-2xl font-bold text-gray-800 text-center">Skyfall Level Generator</h1>
            <div class="text-center mt-4 space-x-4">
                <button id="generateBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-6 rounded-lg shadow-md transition-colors">
                    Generate 2 New Levels
                </button>
                <button id="printBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-1 px-6 rounded-lg shadow-md transition-colors">
                    Print Levels
                </button>
            </div>
        </header>
          <div class="flex-1 gap-4 overflow-auto">
    <div class="flex justify-center">
      <div id="grid1" class="grid" style="grid-template-columns: 2fr 3fr 3fr 3fr 3fr 3fr 3fr 3fr; height: 7.3in; width: 3in;"><!-- Grid cells will be generated by JavaScript -->
     </div>
     <div id="grid2" class="grid" style="grid-template-columns: 2fr 3fr 3fr 3fr 3fr 3fr 3fr 3fr; height: 7.3in; width: 3in;"><!-- Grid cells will be generated by JavaScript -->
</div>
    </div>
   </div>
    </main>
     <script>
        // Grid state
        let gridData1 = [];
        let gridData2 = [];
        
        // Initialize grid
        function initializeGrid() {
            const gridData = [];
            for (let row = 1; row <= 20; row++) {
                // Add blank column (column 0)
                gridData.push({
                    row: row,
                    col: 0,
                    image: null,
                    id: `${row}-0`,
                    isBlankColumn: true
                });
                
                // Add regular columns (1-7)
                for (let col = 1; col <= 7; col++) {
                    gridData.push({
                        row: row,
                        col: col,
                        image: null,
                        id: `${row}-${col}`,
                        isBlankColumn: false
                    });
                }
            }
            return gridData;
        }

        // Get random cell from specific rows (excluding blank column)
        function getRandomCellFromRows(gridData, startRow, endRow, excludeOccupied = true) {
            const availableCells = gridData.filter(cell => 
                cell.row >= startRow && 
                cell.row <= endRow && 
                !cell.isBlankColumn &&
                (!excludeOccupied || cell.image === null)
            );
            if (availableCells.length === 0) return null;
            return availableCells[Math.floor(Math.random() * availableCells.length)];
        }

        // Get random cells from specific rows (excluding blank column)
        function getRandomCellsFromRows(gridData, startRow, endRow, count, excludeOccupied = true) {
            const availableCells = gridData.filter(cell => 
                cell.row >= startRow && 
                cell.row <= endRow && 
                !cell.isBlankColumn &&
                (!excludeOccupied || cell.image === null)
            );
            
            const selectedCells = [];
            const cellsCopy = [...availableCells];
            
            for (let i = 0; i < count && cellsCopy.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * cellsCopy.length);
                selectedCells.push(cellsCopy.splice(randomIndex, 1)[0]);
            }
            
            return selectedCells;
        }

        // Get cells with specific image from rows (excluding blank column)
        function getCellsWithImageFromRows(gridData, imageType, startRow, endRow) {
            return gridData.filter(cell => 
                cell.row >= startRow && 
                cell.row <= endRow && 
                !cell.isBlankColumn &&
                cell.image === imageType
            );
        }

        // Get one cell with specific image from each column in row range (excluding blank column)
        function getOneCellPerColumnWithImage(gridData, imageType, startRow, endRow) {
            const selectedCells = [];
            for (let col = 1; col <= 7; col++) {
                const cellsInColumn = gridData.filter(cell => 
                    cell.col === col && 
                    cell.row >= startRow && 
                    cell.row <= endRow && 
                    !cell.isBlankColumn &&
                    cell.image === imageType
                );
                if (cellsInColumn.length > 0) {
                    const randomCell = cellsInColumn[Math.floor(Math.random() * cellsInColumn.length)];
                    selectedCells.push(randomCell);
                }
            }
            return selectedCells;
        }

        // Generate layout following the rules
        function generateLayout(gridData) {

            // Step 1: Place Image 1
            // 1 in row 1
           let cell = getRandomCellFromRows(gridData, 1, 1);
            if (cell) cell.image = 1;
            
            // 2 more in rows 2-5
            let cells = getRandomCellsFromRows(gridData, 2, 5, 2);
            cells.forEach(cell => cell.image = 1);
            
            // 3 more in rows 6-10
            cells = getRandomCellsFromRows(gridData, 6, 10, 3);
            cells.forEach(cell => cell.image = 1);
            
            // 3 more in rows 11-15
            cells = getRandomCellsFromRows(gridData, 11, 15, 3);
            cells.forEach(cell => cell.image = 1);
            
            // 1 more in rows 16-18
            cell = getRandomCellFromRows(gridData, 16, 18);
            if (cell) cell.image = 1;

            // Step 2: Place Image 2
            // 1 in row 1
            cell = getRandomCellFromRows(gridData, 1, 1);
            if (cell) cell.image = 2;
            
            // 2 in each of rows 2-5
            for (let row = 2; row <= 5; row++) {
                cells = getRandomCellsFromRows(gridData, row, row, 2);
                cells.forEach(cell => cell.image = 2);
            }
            
            // 3 in each of rows 6-10
            for (let row = 6; row <= 10; row++) {
                cells = getRandomCellsFromRows(gridData, row, row, 3);
                cells.forEach(cell => cell.image = 2);
            }
            
            // 4 in each of rows 11-15
            for (let row = 11; row <= 15; row++) {
                cells = getRandomCellsFromRows(gridData, row, row, 4);
                cells.forEach(cell => cell.image = 2);
            }
 	// 5 in each of rows 16-18
            for (let row = 16; row <= 18; row++) {
                cells = getRandomCellsFromRows(gridData, row, row, 5);
                cells.forEach(cell => cell.image = 2);
            }

       

 	// Step 4: Replace Image 2 with Image 4
            // 1 random from rows 1-5
            let availableCells = getCellsWithImageFromRows(gridData, 2, 1, 5);
            for (let i = availableCells.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableCells[i], availableCells[j]] = [availableCells[j], availableCells[i]];
            }
            cells = availableCells.slice(0, 1);
            cells.forEach(cell => cell.image = 4);
            
            // 1 random from rows 6-10
            availableCells = getCellsWithImageFromRows(gridData, 2, 6, 10);
            for (let i = availableCells.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableCells[i], availableCells[j]] = [availableCells[j], availableCells[i]];
            }
            cells = availableCells.slice(0, 1);
            cells.forEach(cell => cell.image = 4);
            
            // 1 random from rows 11-15
            availableCells = getCellsWithImageFromRows(gridData, 2, 11, 15);
            for (let i = availableCells.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableCells[i], availableCells[j]] = [availableCells[j], availableCells[i]];
            }
            cells = availableCells.slice(0, 1);
            cells.forEach(cell => cell.image = 4);
            
            // 1 random from rows 16-18
            availableCells = getCellsWithImageFromRows(gridData, 2, 16, 18);
            for (let i = availableCells.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableCells[i], availableCells[j]] = [availableCells[j], availableCells[i]];
            }
            cells = availableCells.slice(0, 1);
            cells.forEach(cell => cell.image = 4);

            // Step 5: Place Image 5 (one per every 5 rows from 1-15)
            for (let startRow = 1; startRow <= 16; startRow += 5) {
                const endRow = Math.min(startRow + 4, 15);
                cell = getRandomCellFromRows(gridData, startRow, endRow);
                if (cell) cell.image = 5;
            }

            // Step 6: Place Image 6 (one per every 3 rows from 2-16)
            for (let startRow = 2; startRow <= 15; startRow += 3) {
                const endRow = Math.min(startRow + 2, 16);
                cell = getRandomCellFromRows(gridData, startRow, endRow);
                if (cell) cell.image = 6;
            }

            // Step 7: Place Image 7 (one per every 4 rows from 2-16)
            for (let startRow = 2; startRow <= 16; startRow += 4) {
                const endRow = Math.min(startRow + 3, 16);
                cell = getRandomCellFromRows(gridData, startRow, endRow);
                if (cell) cell.image = 7;
            }

            // Step 8: Place Images 8, 9, 10 (2 copies each in rows 5-15)
            [8, 9, 10].forEach(imageNum => {
                cells = getRandomCellsFromRows(gridData, 5, 15, 2);
                cells.forEach(cell => cell.image = imageNum);
            });

            // Step 9: Place Image 11 (one per every 6 rows from 4-16)
            for (let startRow = 4; startRow <= 15; startRow += 6) {
                const endRow = Math.min(startRow + 5, 16);
                cell = getRandomCellFromRows(gridData, startRow, endRow);
                if (cell) cell.image = 11;
            }

            // Step 10: Place Images 12, 13, 14 in blank column (even rows 8-18)
            const evenRows = [];
            for (let row = 8; row <= 18; row += 2) {
                evenRows.push(row);
            }
            
           // Distribute images 12, 13, 14 ensuring at least 2 of each but max 3 of each
            const imageTypes = [12, 13, 14];
            const imageAssignments = [];
            const imageCounts = { 12: 0, 13: 0, 14: 0 };
            
            // First, assign 2 of each image type (minimum requirement)
            imageTypes.forEach(imageType => {
                imageAssignments.push(imageType, imageType);
                imageCounts[imageType] = 2;
            });
            
           
            
            // Shuffle the assignments
            for (let i = imageAssignments.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [imageAssignments[i], imageAssignments[j]] = [imageAssignments[j], imageAssignments[i]];
            }
            
            // Assign to blank column cells
            evenRows.forEach((row, index) => {
                const blankCell = gridData.find(cell => cell.row === row && cell.col === 0);
                if (blankCell && index < imageAssignments.length) {
                    blankCell.image = imageAssignments[index];
                }
            });
        }

        // Render the grid
        function renderGrid(gridData, gridElementId) {
            const gridElement = document.getElementById(gridElementId);
            gridElement.innerHTML = '';

            // Sort grid data by row in descending order (22 to 1), then by column
            const sortedGridData = [...gridData].sort((a, b) => {
                if (a.row !== b.row) {
                    return b.row - a.row; // Descending order for rows
                }
                return a.col - b.col; // Ascending order for columns
            });

            sortedGridData.forEach(cellData => {
 // Handle solid rows 19-22
                if (cellData.row >= 19 && cellData.row <= 20 && cellData.col === 0) {
                    const solidBlock = document.createElement('div');
                    solidBlock.className = 'bg-gray-200 border-2 border-gray-400 rounded-lg grid-cell flex items-center justify-center text-sm font-bold text-gray-700';
                    solidBlock.style.gridColumn = 'span 8';
                    
                    const rowTexts = {
                
                        20: 'Zap! The city is destroyed, you lose!',
                        19: 'Omega Laser Firing in 3...2...1...'
                    };
                    solidBlock.textContent = rowTexts[cellData.row];
                    gridElement.appendChild(solidBlock);
                    return;
                }
                
                // Skip other cells in rows 19-22 since we're spanning
                if (cellData.row >= 19 && cellData.row <= 20 && cellData.col > 0) {
                    return;
                }
                const cellDiv = document.createElement('div');
                
                if (cellData.isBlankColumn) {
                    // Blank column styling
                    cellDiv.className = 'bg-gray-200 border-2 border-gray-200 rounded-0.5g grid-cell flex items-center justify-center';
                    
                    if (cellData.image) {
                        const imageUrls = {
                            12: 'loseheart.png',
                            13: 'losedice.png',
                            14: 'advance.png'
                        };
                        
                        const img = document.createElement('img');
                        img.src = imageUrls[cellData.image];
                        img.alt = `Image ${cellData.image}`;
                        img.onerror = function() {
                            this.src = '';
                            this.alt = 'Image failed to load';
                            this.style.display = 'none';
                        };
                        cellDiv.appendChild(img);
                    }
                } else {
                    cellDiv.className = 'bg-white border-2 border-gray-400 rounded-g flex items-center justify-center text-sm font-medium text-gray-600 hover:bg-blue-50 transition-colors grid-cell';
                    
                         if (cellData.image) {
                    const imageUrls = {
                        1: 'platform.png',
                        2: 'alien.png',
                        3: 'alienred.png',
                        4: 'alienshield.png',
                        5: 'shield.png',
                        6: 'katana.png',
                        7: 'gun.png',
                        8: 'reroll.png',
                        9: 'plusminus.png',
                        10: 'mastery.png',
                        11: 'bomb.png'
                    };
                        
                        const img = document.createElement('img');
                        img.src = imageUrls[cellData.image];
                        img.alt = `Image ${cellData.image}`;
                        img.onerror = function() {
                            this.src = '';
                            this.alt = 'Image failed to load';
                            this.style.display = 'none';
                        };
                        cellDiv.appendChild(img);
                    } 
                }
                
                gridElement.appendChild(cellDiv);
            });
        }

        // Initialize and render first layout
        gridData1 = initializeGrid();
        gridData2 = initializeGrid();
        generateLayout(gridData1);
        generateLayout(gridData2);
        renderGrid(gridData1, 'grid1');
        renderGrid(gridData2, 'grid2');

        // Add event listener to generate button
        document.getElementById('generateBtn').addEventListener('click', function() {
            gridData1 = initializeGrid();
            gridData2 = initializeGrid();
            generateLayout(gridData1);
            generateLayout(gridData2);
            renderGrid(gridData1, 'grid1');
            renderGrid(gridData2, 'grid2');
        });

        // Add event listener to print button
        document.getElementById('printBtn').addEventListener('click', function() {
            window.print();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99533e1ae1e6d96e',t:'MTc2MTU3OTEwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
